<?xml version="1.0" encoding="ISO-8859-1"?>
<DPF>
  <config>
    <workflows>
      <DPF4LOADER.dpf4loader
        COMMENT=""
        DPFINT-Customer="0"
        DPFINT-Interactive="0"
        DPFINT-Type="WorkflowDescription"
        NAME="Document Load - Load any Type"
        PROJECT="DPF4LOADER"
        VERSION="$Id: wf-dpf4loader.xml,v 1.15 2013/12/12 07:49:08 tobias Exp $"
        >
        <DEFAULTS/>
        <DPF4LOADER.ErrorHandler
          COMMENT="handle error"
          ERROR="END"
          NEXT="END"
          POSX="900"
          POSY="1300"
          TYPE="SWF"
          USE="DPF4LOADER.dpf4loader_error_mail"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING/>
        </DPF4LOADER.ErrorHandler>
        <DPF4LOADER.ExtractParameters1
          COMMENT=""
          ERROR="DPF4LOADER.ErrorHandler"
          NAME="DPF4LOADER.ExtractParameters"
          NEXT="ReadConfig"
          POSX="500"
          POSY="700"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="VERTICAL"
            />
          <DEFAULTS>
            <DPFL_CONNPAR
              val="%PLS_DATA_1%"
              />
            <DPFL_LOADPAR
              val="%PLS_DATA_0%"
              />
          </DEFAULTS>
          <MAPPING
            DPFL_VARIANT=""
            />
        </DPF4LOADER.ExtractParameters1>
        <DPF4LOADER.waitforendofmaintenance1
          COMMENT="wait till %MAINTAINENCESTOPFILE% no longer exists"
          ERROR="DPF4LOADER.ErrorHandler"
          NAME="DPF4LOADER.waitforendofmaintenance"
          NEXT="SubProcessDoLoad"
          POSX="300"
          POSY="2300"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="HORIZONTAL"
            />
          <DEFAULTS>
            <MAXPOLL
              val="0"
              />
            <POLLINTERVALL
              val="15"
              />
          </DEFAULTS>
          <MAPPING
            MAINTENANCESTOPFILE="%TMPDIR%/maintenance.stop"
            />
        </DPF4LOADER.waitforendofmaintenance1>
        <DoConvertAndStamp
          COMMENT=""
          ERROR="DPF4LOADER.ErrorHandler"
          NEXT="If-DoRename"
          POSX="500"
          POSY="1400"
          TYPE="SWF"
          USE="DPF4VIEW.prepare_single"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="VERTICAL"
            />
          <DEFAULTS/>
          <MAPPING/>
        </DoConvertAndStamp>
        <DoRename
          COMMENT="rename file"
          ERROR="DPF4LOADER.ErrorHandler"
          NAME="FileTransfer.mv"
          NEXT="DoRenameUpdateCurrFileName"
          POSX="500"
          POSY="1900"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="HORIZONTAL"
            />
          <DEFAULTS/>
          <MAPPING
            SOURCE="%CurrFileName%"
            TARGET="%NewFileName%"
            />
        </DoRename>
        <DoRenameSetNewName
          COMMENT="take the target filename from header plus current workdir as path"
          NEXT="DoRename"
          POSX="500"
          POSY="1700"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="HORIZONTAL"
            />
          <SET
            NewFileName="%JobDir%/%TARGETFILENAME%"
            />
        </DoRenameSetNewName>
        <DoRenameUpdateCurrFileName
          COMMENT=""
          NEXT="DPF4LOADER.waitforendofmaintenance1"
          POSX="500"
          POSY="2100"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="VERTICAL"
            />
          <SET
            CurrFilename="%NewFileName%"
            />
        </DoRenameUpdateCurrFileName>
        <END
          COMMENT=""
          NAME="END"
          POSX="1300"
          POSY="2800"
          TYPE="STOP"
          />
        <IF-Data0WithDataCOPY
          COMMENT=""
          ELSE="ReadConfig"
          OPERATOR="contains"
          POSX="300"
          POSY="600"
          PROPERTY="PLS_DATA_0"
          THEN="DPF4LOADER.ExtractParameters1"
          TYPE="IF-THEN-ELSE"
          VALUE="|"
          >
          <CONNECTIONS
            ELSE="HORIZONTAL"
            THEN="VERTICAL"
            />
        </IF-Data0WithDataCOPY>
        <IF-DoConvert
          COMMENT="Determine if file should be converted/stamped"
          ELSE="If-DoRename"
          OPERATOR="begins with"
          POSX="300"
          POSY="1300"
          PROPERTY="DPFL_DOCONVERSION"
          THEN="DoConvertAndStamp"
          TYPE="IF-THEN-ELSE"
          VALUE="Y"
          >
          <CONNECTIONS
            ELSE="DIRECT"
            THEN="VERTICAL"
            />
        </IF-DoConvert>
        <IF-THEN-ELSE1
          COMMENT=""
          ELSE="MODIFY2"
          OPERATOR="exists"
          POSX="300"
          POSY="300"
          PROPERTY="DPFL_VARIANT"
          THEN="IF-Data0WithDataCOPY"
          TYPE="IF-THEN-ELSE"
          VALUE=""
          >
          <CONNECTIONS
            ELSE="VERTICAL"
            THEN="DIRECT"
            />
        </IF-THEN-ELSE1>
        <If-DoRename
          COMMENT="Determine if file should be renamed"
          ELSE="DPF4LOADER.waitforendofmaintenance1"
          OPERATOR="ne"
          POSX="300"
          POSY="1600"
          PROPERTY="TARGETFILENAME"
          THEN="DoRenameSetNewName"
          TYPE="IF-THEN-ELSE"
          VALUE=""
          >
          <CONNECTIONS
            ELSE="HORIZONTAL"
            THEN="VERTICAL"
            />
        </If-DoRename>
        <MAIN
          BEGIN="ReadJobData"
          NAME=""
          />
        <MAPPING/>
        <MODIFY1
          COMMENT="Since WU ReadMultipleIniFiles does not expand variables and no other WU does this for JOBNAME we need to do it manually.

This might cause trouble (empty JOBNAME) but since we define a default it should not happen"
          NEXT="IF-DoConvert"
          POSX="300"
          POSY="1100"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            CURRFILETYPE="%CurrFileName.extension%"
            JOBNAME="%JOBNAME%"
            />
        </MODIFY1>
        <MODIFY2
          COMMENT=""
          NEXT="IF-Data0WithDataCOPY"
          POSX="500"
          POSY="400"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="VERTICAL"
            />
          <SET
            DPFL_VARIANT="SAPDMS"
            />
        </MODIFY2>
        <ReadConfig
          COMMENT="Read Configuration - Default and specific for DPFL_VARIANT"
          ERROR="DPF4LOADER.ErrorHandler"
          NAME="FileSystem.ReadMultipleIniFiles"
          NEXT="MODIFY1"
          POSX="300"
          POSY="900"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS>
            <ForceIniValues
              val="N"
              />
            <IniFileName
              val="%PLSSV%/dpf/conf/dpf4publish/publish.ini"
              />
            <OptionalFirstIniFile
              val="N"
              />
            <OverwriteDefaultValues
              val="N"
              />
            <SectionNames
              val="MAIN"
              />
          </DEFAULTS>
          <MAPPING
            IniFileName="%DPFSRV%\conf\dpf4loader\dpf4loader.ini"
            OverwriteDefaultValues="Y"
            SecondIniFileName="%SEAL_CUSTOMDIR%\server\dpf\conf\dpf4loader\dpf4loader.ini"
            SectionNames="MAIN,DPF4LOADER,DEFAULTS,%CurrFileName.extension.toUpper%,%DPFL_VARIANT.toUpper%,%DPFL_VARIANT.toUpper%_%CurrFileName.extension.toUpper%"
            />
        </ReadConfig>
        <ReadJobData
          COMMENT="Read the Job data from Header file"
          ERROR="DPF4LOADER.ErrorHandler"
          NAME="NetDome.readHeader"
          NEXT="IF-THEN-ELSE1"
          POSX="300"
          POSY="100"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS>
            <OVERWRITEPROPERTIES
              val="Y"
              />
          </DEFAULTS>
          <MAPPING
            CURRHEDFILENAME="%CurrFileName.baseName%.hed"
            OVERWRITEPROPERTIES="N"
            />
        </ReadJobData>
        <SubProcessDoLoad
          COMMENT="load file to target system"
          ERROR="DPF4LOADER.ErrorHandler"
          NEXT="END"
          POSX="300"
          POSY="2600"
          TYPE="USER_EXIT"
          USE="DPF4Loader.%DPFL_VARIANT%loader"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING/>
        </SubProcessDoLoad>
      </DPF4LOADER.dpf4loader>
    </workflows>
  </config>
</DPF>
