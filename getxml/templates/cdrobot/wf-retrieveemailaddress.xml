<?xml version="1.0" encoding="ISO-8859-1"?>
<DPF>
  <config>
    <workflows>
      <CdRobot.retrieveEmailAddress
        COMMENT=""
        DPFINT-Icon="doc://:/wf.gif"
        DPFINT-Type="WorkflowDescription"
        INTERNALNAME="CdRobot.retrieveEmailAddress"
        NAME="Retrieve EMail Address"
        PROJECT="CdRobot"
        VERSION="$Id: wf-retrieveemailaddress.xml,v 1.7 2006/12/12 21:03:16 stefan Exp $"
        >
        <DEFAULTS
          DPFINT-Icon="doc://:/defaults.gif"
          />
        <END
          COMMENT=""
          NAME="END"
          POSX="400"
          POSY="1100"
          TYPE="STOP"
          />
        <MAIN
          BEGIN="ifLDAP"
          NAME=""
          />
        <MAPPING/>
        <checkEmail
          COMMENT=""
          ELSE="sendUnknownMail"
          OPERATOR="contains"
          POSX="200"
          POSY="1100"
          PROPERTY="EMAIL"
          THEN="sendTrackMail"
          TYPE="IF-THEN-ELSE"
          VALUE="@"
          >
          <CONNECTIONS
            ELSE="VERTICAL"
            THEN="VERTICAL"
            />
        </checkEmail>
        <getEmailAddressFromFile
          COMMENT=""
          ERROR="END"
          NAME="CdRobot.getEmailAddress"
          NEXT="checkEmail"
          POSX="100"
          POSY="900"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="VERTICAL"
            />
          <DEFAULTS/>
          <MAPPING/>
        </getEmailAddressFromFile>
        <ifHaveLdapEmail
          COMMENT=""
          ELSE="getEmailAddressFromFile"
          OPERATOR="exists"
          POSX="300"
          POSY="700"
          PROPERTY="LDAP_mail"
          THEN="setEmailFromLdap"
          TYPE="IF-THEN-ELSE"
          VALUE=""
          >
          <CONNECTIONS
            ELSE="VERTICAL"
            THEN="VERTICAL"
            />
        </ifHaveLdapEmail>
        <ifHaveLdapUser
          COMMENT=""
          ELSE="ifHaveLdapEmail"
          OPERATOR="exists"
          POSX="300"
          POSY="500"
          PROPERTY="LDAP_cn"
          THEN="setJobUser"
          TYPE="IF-THEN-ELSE"
          VALUE=""
          >
          <CONNECTIONS
            ELSE="VERTICAL"
            THEN="VERTICAL"
            />
        </ifHaveLdapUser>
        <ifLDAP
          COMMENT=""
          ELSE="searchUserInLDAP"
          OPERATOR="eq"
          POSX="200"
          POSY="100"
          PROPERTY="LDAP_HOSTNAME"
          THEN="getEmailAddressFromFile"
          TYPE="IF-THEN-ELSE"
          VALUE=""
          >
          <CONNECTIONS
            ELSE="VERTICAL"
            THEN="VERTICAL"
            />
        </ifLDAP>
        <searchUserInLDAP
          COMMENT=""
          ERROR="END"
          NAME="Net.searchLDAP"
          NEXT="ifHaveLdapUser"
          POSX="300"
          POSY="300"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING
            LDAP_IGNORE_ERRORS="Y"
            />
        </searchUserInLDAP>
        <sendTrackMail
          COMMENT=""
          ERROR="END"
          NAME="Mail.sendMail"
          NEXT="END"
          POSX="100"
          POSY="1300"
          TYPE="WU"
          >
          <DEFAULTS
            MAIL_ATTACH_PROPERTIES=""
            MAIL_EXPAND_TEXT="Y"
            MAIL_SUBJECT="Jobverfolgung Deines CD Brennauftrags von %TARROOTDIR%"
            MAIL_TEXT="Hallo %JOBUSERNAME%,\n\nDein CD Brennauftrag wird soeben in der DPF verarbeitet.\nWenn die CD fertig ist, wirst Du nochmal per Mail benachrichtigt.\n\nUnter folgenden URL&apos;s kannst Du Deinen aktuellen Auftrag bzw.\nalle Deine Aufträge auch online verfolgen:\n\n   %DPFTRACKERURL%?job=%JOBID%\n   %DPFTRACKERURL%\n\nHinweis: Schalte den Proxy für den Rechner &apos;%DPFSERVERNAME%&apos; aus!"
            MAIL_TO="%EMAIL%"
            MKISO_VOLUME_ID=""
            RECEIVER="(unbekannt)"
            />
          <MAPPING/>
        </sendTrackMail>
        <sendUnknownMail
          COMMENT=""
          ERROR="END"
          NAME="Mail.sendMail"
          NEXT="setAdminEmail"
          POSX="300"
          POSY="1300"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="HORIZONTAL"
            />
          <DEFAULTS
            MAIL_ATTACH_PROPERTIES=""
            MAIL_EXPAND_TEXT="Y"
            MAIL_SUBJECT="Keine Email für Rechner %ORIGHOSTNAME% gefunden"
            MAIL_TEXT="Hallo DPF Admin,\n\nfür den CD Brennauftrag von Rechner %ORIGHOSTNAME% konnte keine\nEMail Adresse bestimmt werden.\nBitte pflege die Datei server/dpf/conf/CdRobot/seal* nach.\n\nDer CD Brennauftrag wird soeben in der DPF verarbeitet.\nWenn die CD fertig ist, wirst Du nochmal per Mail benachrichtigt.\n\nUnter folgender URL kannst Du Deinen Auftrag auch online verfolgen:\n\n   %DPFTRACKERURL%?job=%JOBID%\n\nHinweis: Schalte den Proxy für den Rechner &apos;%DPFSERVERNAME%&apos; aus!"
            MAIL_TO="%MAIL_DPFADMIN%"
            MKISO_VOLUME_ID=""
            RECEIVER="(unbekannt)"
            />
          <MAPPING/>
        </sendUnknownMail>
        <setAdminEmail
          COMMENT=""
          NEXT="END"
          POSX="300"
          POSY="1500"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            EMAIL="%MAIL_DPFADMIN%"
            />
        </setAdminEmail>
        <setEmailFromLdap
          COMMENT=""
          NEXT="checkEmail"
          POSX="300"
          POSY="900"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="VERTICAL"
            />
          <SET
            EMAIL="%LDAP_mail%"
            />
        </setEmailFromLdap>
        <setJobUser
          COMMENT=""
          NEXT="ifHaveLdapEmail"
          POSX="500"
          POSY="700"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="VERTICAL"
            />
          <SET
            JOBUSERNAME="%LDAP_cn%"
            />
        </setJobUser>
      </CdRobot.retrieveEmailAddress>
    </workflows>
  </config>
</DPF>
