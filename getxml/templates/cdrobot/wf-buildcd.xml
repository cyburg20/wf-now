<?xml version="1.0" encoding="ISO-8859-1"?>
<DPF>
  <config>
    <workflows>
      <CdRobot.buildCd
        COMMENT="general purpose CD burn workflow"
        DPFINT-Icon="doc://:/wf.gif"
        DPFINT-Interactive="0"
        DPFINT-Type="WorkflowDescription"
        NAME="Build CD (general purpose)"
        PROJECT="CdRobot"
        VERSION="$Id: wf-buildcd.xml,v 1.15 2007/03/15 09:39:19 stefan Exp $"
        >
        <DEFAULTS
          DPFINT-Icon="doc://:/defaults.gif"
          />
        <END
          COMMENT=""
          NAME="END"
          POSX="1000"
          POSY="6000"
          TYPE="STOP"
          />
        <MAIN
          BEGIN="set00"
          ERROR="errorHandling"
          />
        <MAPPINGS/>
        <checkCustomer
          COMMENT=""
          ELSE="haveIsoFileFromPreviousRun"
          OPERATOR="exists"
          POSX="200"
          POSY="1900"
          PROPERTY="CUSTOMER"
          THEN="setReceiver"
          TYPE="IF-THEN-ELSE"
          VALUE=""
          >
          <CONNECTIONS
            ELSE="VERTICAL"
            THEN="VERTICAL"
            />
        </checkCustomer>
        <checkOffline
          COMMENT=""
          ELSE="set10"
          OPERATOR="is file"
          POSX="200"
          POSY="1500"
          PROPERTY="OFFLINEFILE"
          THEN="sendOfflineMail"
          TYPE="IF-THEN-ELSE"
          VALUE=""
          >
          <CONNECTIONS
            ELSE="DIRECT"
            THEN="DIRECT"
            />
        </checkOffline>
        <checkSimulate
          COMMENT=""
          ELSE="toastCD"
          OPERATOR="is true"
          POSX="200"
          POSY="3600"
          PROPERTY="SIMULATE"
          THEN="sendSimulationMail"
          TYPE="IF-THEN-ELSE"
          VALUE=""
          >
          <CONNECTIONS
            ELSE="VERTICAL"
            THEN="VERTICAL"
            />
        </checkSimulate>
        <createCdLabel
          COMMENT=""
          ERROR="errorHandling"
          NAME="CdRobot.createCdLabel"
          NEXT="set65"
          POSX="200"
          POSY="3200"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS
            COMBI_RECEIVER="Empfänger: %RECEIVER%"
            COMBI_VERSION="Version %VERSION%"
            />
          <MAPPING/>
        </createCdLabel>
        <createIsoDependingOnDriveType
          COMMENT=""
          ERROR="errorHandling"
          NEXT="ifHaveImageFile"
          POSX="300"
          POSY="2500"
          TYPE="SWF"
          USE="CdRobot.createIsoDependingOnDriveType"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="VERTICAL"
            />
          <DEFAULTS/>
          <MAPPING/>
        </createIsoDependingOnDriveType>
        <errorHandling
          COMMENT=""
          ERROR="set100"
          NEXT="set100"
          POSX="900"
          POSY="4700"
          TYPE="SWF"
          USE="CdRobot.errorHandling"
          >
          <CONNECTIONS
            ERROR="HORIZONTAL"
            NEXT="HORIZONTAL"
            />
          <DEFAULTS/>
          <MAPPING/>
        </errorHandling>
        <haveIsoFileFromPreviousRun
          COMMENT=""
          ELSE="createIsoDependingOnDriveType"
          OPERATOR="is file"
          POSX="100"
          POSY="2200"
          PROPERTY="ISOFILETEST"
          THEN="setPreviousIsoFile"
          TYPE="IF-THEN-ELSE"
          VALUE=""
          >
          <CONNECTIONS
            ELSE="VERTICAL"
            THEN="DIRECT"
            />
        </haveIsoFileFromPreviousRun>
        <ifHaveImageFile
          COMMENT=""
          ELSE="set100"
          OPERATOR="is file"
          POSX="200"
          POSY="2800"
          PROPERTY="IMAGEFILE"
          THEN="set60"
          TYPE="IF-THEN-ELSE"
          VALUE=""
          >
          <CONNECTIONS
            ELSE="VERTICAL"
            THEN="VERTICAL"
            />
        </ifHaveImageFile>
        <initializeSettings
          COMMENT="notice, property USER is already set before calling this sub workflow"
          ERROR="errorHandling"
          NEXT="readHeader"
          POSX="200"
          POSY="300"
          TYPE="SWF"
          USE="CdRobot.Settings"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING/>
        </initializeSettings>
        <readHeader
          COMMENT="read optional header file with additional properties"
          ERROR="errorHandling"
          NAME="NetDome.readHeader"
          NEXT="set02"
          POSX="200"
          POSY="500"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING/>
        </readHeader>
        <retrieveEmailAddress
          COMMENT="retrieve EMail address from LDAP or from file. If it does not exist, send Mail to DPF admin."
          ERROR="errorHandling"
          NEXT="set04"
          POSX="200"
          POSY="1100"
          TYPE="SWF"
          USE="CdRobot.retrieveEmailAddress"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING/>
        </retrieveEmailAddress>
        <sendFinishMail
          COMMENT=""
          ERROR="errorHandling"
          NAME="Mail.sendMail"
          NEXT="set100"
          POSX="100"
          POSY="4700"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="HORIZONTAL"
            />
          <DEFAULTS
            CDLABELPDF="%JOBDIR%/cdlabel.pdf"
            EMAIL="%MAIL_DPFADMIN%"
            MAIL_ATTACH_PROPERTIES="PDFLABELFILE"
            MAIL_EXPAND_TEXT="Y"
            MAIL_SUBJECT="Deine CD %MKISO_VOLUME_ID% von %TARROOTDIR% ist abholbereit!"
            MAIL_TEXT="Hallo %JOBUSERNAME%,\n\nDein CD Brennauftrag ist nun komplett fertig. Du kannst Deine CD\nfür den Empfänger %RECEIVER% abholen.\n\nDie CD ist %TREESIZE% KByte groß.\nFalls Du wissen möchtest, wie Deine CD aussieht, anbei\nist ein Preview als PDF."
            MAIL_TO="%EMAIL%"
            MKISO_VOLUME_ID=""
            RECEIVER="(unbekannt)"
            />
          <MAPPING/>
        </sendFinishMail>
        <sendOfflineMail
          COMMENT=""
          ERROR="errorHandling"
          NAME="Mail.sendMail"
          NEXT="set100"
          POSX="600"
          POSY="1500"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="VERTICAL"
            />
          <DEFAULTS
            EMAIL="%MAIL_DPFADMIN%"
            MAIL_ATTACH_PROPERTIES=""
            MAIL_EXPAND_TEXT="Y"
            MAIL_SUBJECT="CD-Roboter ist offline"
            MAIL_TEXT="Hallo %JOBUSERNAME%,\n\nDein CD Brennauftrag kann leider nicht verarbeitet werden.\nDer CD-Roboter ist offline.\n"
            MAIL_TO="%EMAIL%"
            MKISO_VOLUME_ID=""
            RECEIVER="(unbekannt)"
            />
          <MAPPING/>
        </sendOfflineMail>
        <sendSimulationMail
          COMMENT=""
          ERROR="errorHandling"
          NAME="Mail.sendMail"
          NEXT="set100"
          POSX="300"
          POSY="3800"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="VERTICAL"
            />
          <DEFAULTS
            CDLABELPDF="%JOBDIR%/cdlabel.pdf"
            EMAIL="%MAIL_DPFADMIN%"
            MAIL_ATTACH_PROPERTIES="PDFLABELFILE"
            MAIL_EXPAND_TEXT="Y"
            MAIL_SUBJECT="Simulation der CD %MKISO_VOLUME_ID% von %TARROOTDIR% beendet"
            MAIL_TEXT="Hallo %JOBUSERNAME%,\n\ndie Simulation Deines CD Brennauftrags ist nun komplett fertig.\nEs wurde keine CD gebrannt, der Rest wurde jedoch komplett durchlaufen.\n\nDie CD wäre %TREESIZE% KByte groß geworden.\nFalls Du wissen möchtest, wie das CD Label aussieht, anbei\nist ein Preview als PDF."
            MAIL_TO="%EMAIL%"
            MKISO_VOLUME_ID=""
            RECEIVER="(unbekannt)"
            />
          <MAPPING/>
        </sendSimulationMail>
        <set00
          COMMENT=""
          NEXT="initializeSettings"
          POSX="200"
          POSY="100"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="0"
            ISOFILETEST="%JOBDIR%/isofile.iso"
            TREESIZE="0"
            USER="%ORIGUSERNAME%"
            />
        </set00>
        <set02
          COMMENT=""
          NEXT="retrieveEmailAddress"
          POSX="200"
          POSY="900"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="2"
            />
        </set02>
        <set04
          COMMENT=""
          NEXT="checkOffline"
          POSX="200"
          POSY="1300"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="4"
            />
        </set04>
        <set10
          COMMENT=""
          NEXT="checkCustomer"
          POSX="200"
          POSY="1700"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="10"
            />
        </set10>
        <set100
          COMMENT=""
          NEXT="END"
          POSX="700"
          POSY="5100"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="100"
            />
        </set100>
        <set60
          COMMENT=""
          NEXT="createCdLabel"
          POSX="200"
          POSY="3000"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="60"
            />
        </set60>
        <set65
          COMMENT=""
          NEXT="checkSimulate"
          POSX="200"
          POSY="3400"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="65"
            />
        </set65>
        <set80
          COMMENT=""
          NEXT="waitForCD"
          POSX="100"
          POSY="4100"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="80"
            />
        </set80>
        <set95
          COMMENT=""
          NEXT="sendFinishMail"
          POSX="100"
          POSY="4500"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="95"
            />
        </set95>
        <setPreviousIsoFile
          COMMENT="	"
          NEXT="ifHaveImageFile"
          POSX="100"
          POSY="2500"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="VERTICAL"
            />
          <SET
            IMAGEFILE="%JOBDIR%/isofile.iso"
            />
        </setPreviousIsoFile>
        <setReceiver
          COMMENT=""
          NEXT="haveIsoFileFromPreviousRun"
          POSX="400"
          POSY="2100"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="HORIZONTAL"
            />
          <SET
            RECEIVER="%CUSTOMER%"
            />
        </setReceiver>
        <toastCD
          COMMENT=""
          ERROR="errorHandling"
          NAME="CdRobot.toastAdr"
          NEXT="set80"
          POSX="100"
          POSY="3900"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING/>
        </toastCD>
        <waitForCD
          COMMENT=""
          ERROR="errorHandling"
          NAME="CdRobot.waitAdr"
          NEXT="set95"
          POSX="100"
          POSY="4300"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING/>
        </waitForCD>
      </CdRobot.buildCd>
    </workflows>
  </config>
</DPF>
