<?xml version="1.0" encoding="ISO-8859-1"?>
<DPF>
  <config>
    <workflows>
      <CdRobot.buildCdFromDirs
        COMMENT="burn a CD for each sub directory in a given directory"
        DPFINT-Icon="doc://:/wf.gif"
        DPFINT-Interactive="0"
        DPFINT-Type="WorkflowDescription"
        INTERNALNAME="CdRobot.buildCdFromDirs"
        NAME="Build CDs from sub-directories"
        PROJECT="CdRobot"
        VERSION="$Id: wf-buildcdfromdirs.xml,v 1.10 2006/12/12 20:49:05 stefan Exp $"
        >
        <DEFAULTS
          DPFINT-Icon="doc://:/defaults.gif"
          />
        <END
          COMMENT=""
          NAME="END"
          POSX="600"
          POSY="2600"
          TYPE="STOP"
          />
        <MAIN
          BEGIN="searchLDAP"
          ERROR="errormail"
          />
        <buildcds
          COMMENT=""
          ERROR="errormail"
          NAME="CdRobot.buildCds"
          NEXT="sendconfirmation"
          POSX="300"
          POSY="2200"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING
            ROOTDIR="%TARROOTDIR%"
            />
        </buildcds>
        <checkResulteMail
          COMMENT=""
          ELSE="getemailaddress"
          OPERATOR="exists"
          POSX="200"
          POSY="300"
          PROPERTY="LDAP_mail"
          THEN="modifyMail2EMail"
          TYPE="IF-THEN-ELSE"
          >
          <CONNECTIONS
            ELSE="VERTICAL"
            THEN="VERTICAL"
            />
        </checkResulteMail>
        <checkdrivetype
          COMMENT=""
          DEFAULT="wrongdrive"
          POSX="100"
          POSY="1600"
          PROPERTY="DRIVE_TYPE"
          TYPE="SWITCH"
          >
          <CONNECTIONS
            DEFAULT="VERTICAL"
            LOCAL="DIRECT"
            NOVELL="DIRECT"
            REMOTE="DIRECT"
            SAMBA="VERTICAL"
            UNIX="VERTICAL"
            />
          <cases
            LOCAL="clientls"
            NOVELL="clientls"
            REMOTE="clientls"
            SAMBA="checkservertype"
            UNIX="unixls"
            />
        </checkdrivetype>
        <checkemail
          COMMENT=""
          ELSE="sendunknownmail"
          OPERATOR="exists"
          POSX="200"
          POSY="700"
          PROPERTY="EMAIL"
          THEN="sendtrackmail"
          TYPE="IF-THEN-ELSE"
          >
          <CONNECTIONS
            ELSE="VERTICAL"
            THEN="VERTICAL"
            />
        </checkemail>
        <checkservertype
          COMMENT=""
          ELSE="serverls"
          OPERATOR="eq"
          POSX="400"
          POSY="1900"
          PROPERTY="WANT_UNIX"
          THEN="unixls"
          TYPE="IF-THEN-ELSE"
          VALUE="Y"
          >
          <CONNECTIONS
            ELSE="VERTICAL"
            THEN="VERTICAL"
            />
        </checkservertype>
        <clientls
          COMMENT=""
          ERROR="errormail"
          NAME="CdRobot.clientLs"
          NEXT="buildcds"
          POSX="100"
          POSY="1800"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="HORIZONTAL"
            />
          <DEFAULTS/>
          <MAPPING
            ROOTDIR="%TARROOTDIR%"
            />
        </clientls>
        <errormail
          COMMENT=""
          ERROR="END"
          NAME="Mail.sendMail"
          NEXT="END"
          POSX="800"
          POSY="2400"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="HORIZONTAL"
            NEXT="VERTICAL"
            />
          <DEFAULTS
            EMAIL="%MAIL_DPFADMIN%"
            JOBLOGFILE="%JOBDIR%/job.log"
            MAIL_ATTACH_PROPERTIES="JOBLOGFILE"
            MAIL_CC="%MAIL_DPFADMIN%"
            MAIL_EXPAND_TEXT="Y"
            MAIL_SUBJECT="Fehler beim CD Brennauftrag &apos;%MKISO_VOLUME_ID%&apos; mit %TARROOTDIR%"
            MAIL_TEXT="Hallo %JOBUSERNAME%,\n\nbei Deinem CD Brennauftrag mit dem Verzeichnis %TARROOTDIR%\ntrat ein Fehler auf.\n\nFehlergrund: %ERR_REASON%\n\nDer Fehler trat an der Stelle\n\n   Workflow %ERR_WFNAME%\n   Position %ERR_WFPOSITION%\n   DPF Job %JOBID%\n   Client:   %ORIGHOSTNAME%\n\nauf. Für weitere Details siehe die Job Protokolldatei im Anhang dieser Mail,\noder unter %DPFTRACKERURL%?job=%JOBID% .\n\nDer DPF Systemadministrator wurde ebenfalls informiert."
            MAIL_TO="%EMAIL%"
            MKISO_VOLUME_ID=""
            />
          <MAPPING/>
        </errormail>
        <getdrivetype
          COMMENT=""
          ERROR="wrongdrive"
          NAME="CdRobot.getDriveType"
          NEXT="checkdrivetype"
          POSX="100"
          POSY="1400"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING
            INPUTPATH="%TARROOTDIR%"
            NET_USE_FILE="%CURRFILENAME%"
            OUTPUTPROPERTY="TARROOTDIR"
            />
        </getdrivetype>
        <getemailaddress
          COMMENT=""
          ERROR="errormail"
          NAME="CdRobot.getEmailAddress"
          NEXT="checkemail"
          POSX="300"
          POSY="500"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="VERTICAL"
            />
          <DEFAULTS/>
          <MAPPING/>
        </getemailaddress>
        <hed2par
          COMMENT=""
          ERROR="errormail"
          NAME="NetDome.readHeader"
          NEXT="getdrivetype"
          POSX="100"
          POSY="1200"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING/>
        </hed2par>
        <modifyMail2EMail
          COMMENT=""
          NEXT="checkemail"
          POSX="100"
          POSY="500"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="VERTICAL"
            />
          <SET
            EMAIL="%LDAP_mail%"
            />
        </modifyMail2EMail>
        <searchLDAP
          COMMENT=""
          ERROR="errormail"
          NAME="searchLDAP"
          NEXT="checkResulteMail"
          POSX="200"
          POSY="100"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING/>
        </searchLDAP>
        <sendconfirmation
          COMMENT=""
          ERROR="errormail"
          NAME="Mail.sendMail"
          NEXT="END"
          POSX="300"
          POSY="2400"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="VERTICAL"
            />
          <DEFAULTS
            EMAIL="%MAIL_DPFADMIN%"
            MAIL_ATTACH_PROPERTIES=""
            MAIL_EXPAND_TEXT="Y"
            MAIL_SUBJECT="Deine %NUMBER_OF_CDS% CD&apos;s mit %TARROOTDIR% sind abholbereit!"
            MAIL_TEXT="Hallo %JOBUSERNAME%,\n\nDein CD Brennauftrag ist nun komplett fertig. Du kannst Deine %NUMBER_OF_CDS% CD&apos;s\nfür den Empfänger %RECEIVER% abholen."
            MAIL_TO="%EMAIL%"
            RECEIVER="(unbekannt)"
            />
          <MAPPING/>
        </sendconfirmation>
        <sendtrackmail
          COMMENT=""
          ERROR="errormail"
          NAME="Mail.sendMail"
          NEXT="hed2par"
          POSX="100"
          POSY="900"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS
            EMAIL="%MAIL_DPFADMIN%"
            MAIL_ATTACH_PROPERTIES=""
            MAIL_EXPAND_TEXT="Y"
            MAIL_SUBJECT="Jobverfolgung Deines CD Brennauftrags"
            MAIL_TEXT="Hallo %JOBUSERNAME%,\n\nDein CD Brennauftrag wird soeben in der DPF verarbeitet.\nWenn die CD fertig ist, wirst Du nochmal per Mail benachrichtigt.\n\nUnter folgenden URL&apos;s kannst Du Deinen aktuellen Auftrag bzw.\nalle Deine Aufträge auch online verfolgen:\n\n   %DPFTRACKERURL%?job=%JOBID%\n   %DPFTRACKERURL%\n\nHinweis: Schalte den Proxy für den Rechner &apos;%DPFSERVERNAME%&apos; aus!"
            MAIL_TO="%EMAIL%"
            MKISO_VOLUME_ID=""
            RECEIVER="(unbekannt)"
            />
          <MAPPING/>
        </sendtrackmail>
        <sendunknownmail
          COMMENT=""
          ERROR="errormail"
          NAME="Mail.sendMail"
          NEXT="setemail"
          POSX="300"
          POSY="900"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS
            MAIL_ATTACH_PROPERTIES=""
            MAIL_EXPAND_TEXT="Y"
            MAIL_SUBJECT="Keine Email für Rechner %ORIGHOSTNAME% gefunden"
            MAIL_TEXT="Hallo DPF Admin,\n\nfür den CD Brennauftrag von Rechner %ORIGHOSTNAME% konnte keine\nEMail Adresse bestimmt werden.\nBitte pflege die Datei server/dpf/conf/cdrobot/seal* nach.\n\nDer CD Brennauftrag wird soeben in der DPF verarbeitet.\nWenn die CD fertig ist, wirst Du nochmal per Mail benachrichtigt.\n\nUnter folgender URL kannst Du Deinen Auftrag auch online verfolgen:\n\n   %DPFTRACKERURL%?job=%JOBID%\n\nHinweis: Schalte den Proxy für den Rechner &apos;%DPFSERVERNAME%&apos; aus!"
            MAIL_TO="%MAIL_DPFADMIN%"
            MKISO_VOLUME_ID=""
            RECEIVER="(unbekannt)"
            />
          <MAPPING/>
        </sendunknownmail>
        <serverls
          COMMENT=""
          ERROR="errormail"
          NAME="CdRobot.serverLs"
          NEXT="buildcds"
          POSX="500"
          POSY="2100"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="HORIZONTAL"
            />
          <DEFAULTS/>
          <MAPPING
            ROOTDIR="%TARROOTDIR%"
            />
        </serverls>
        <setemail
          COMMENT=""
          NEXT="hed2par"
          POSX="300"
          POSY="1100"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="HORIZONTAL"
            />
          <SET
            EMAIL="%MAIL_DPFADMIN%"
            />
        </setemail>
        <unixls
          COMMENT=""
          ERROR="errormail"
          NAME="CdRobot.unixLs"
          NEXT="buildcds"
          POSX="300"
          POSY="2000"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING
            ROOTDIR="%TARROOTDIR%"
            />
        </unixls>
        <wrongdrive
          COMMENT=""
          ERROR="errormail"
          NAME="Mail.sendMail"
          NEXT="END"
          POSX="500"
          POSY="1700"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="VERTICAL"
            NEXT="VERTICAL"
            />
          <DEFAULTS
            EMAIL="%MAIL_DPFADMIN%"
            JOBLOGFILE="%JOBDIR%/job.log"
            MAIL_ATTACH_PROPERTIES="JOBLOGFILE"
            MAIL_CC="%MAIL_DPFADMIN%"
            MAIL_EXPAND_TEXT="Y"
            MAIL_SUBJECT="Fehler beim CD Brennauftrag &apos;%MKISO_VOLUME_ID%&apos; mit %TARROOTDIR%"
            MAIL_TEXT="Hallo %JOBUSERNAME%,\n\nbei Deinem CD Brennauftrag mit dem Verzeichnis %TARROOTDIR%\ntrat ein Fehler auf.\n\nFehlergrund: Es kann nicht von dem angegebenen Pfad gebrannt werden.\n\nDer Fehler trat an der Stelle\n\n   Workflow: %ERR_WFNAME%\n   Position: %ERR_WFPOSITION%\n   DPF Job:  %JOBID%\n   Client:   %ORIGHOSTNAME%\n\nauf. Für weitere Details siehe die Job Protokolldatei im Anhang dieser Mail,\noder unter %DPFTRACKERURL%?job=%JOBID% .\n\nDer DPF Systemadministrator wurde ebenfalls informiert."
            MAIL_TO="%EMAIL%"
            MKISO_VOLUME_ID=""
            />
          <MAPPING/>
        </wrongdrive>
      </CdRobot.buildCdFromDirs>
    </workflows>
  </config>
</DPF>
