<?xml version="1.0" encoding="ISO-8859-1"?>
<DPF>
  <config>
    <workflows>
      <CdRobot.unixBuild
        COMMENT="build CD data on DPF unix side
progress 15...60"
        DPFINT-Icon="doc://:/wf.gif"
        DPFINT-Interactive="0"
        DPFINT-Type="WorkflowDescription"
        NAME="Build CD at unix side"
        PROJECT="CdRobot"
        VERSION="$Id: wf-unixbuild.xml,v 1.13 2007/03/09 11:47:42 stefan Exp $"
        >
        <DEFAULTS
          DPFINT-Icon="doc://:/defaults.gif"
          />
        <END
          COMMENT=""
          NAME="END"
          POSX="700"
          POSY="2100"
          TYPE="STOP"
          />
        <MAIN
          BEGIN="mapSambaDrive"
          />
        <checkEmpty
          COMMENT=""
          ELSE="sendErrorEmptyMail"
          OPERATOR="ge"
          POSX="200"
          POSY="700"
          PROPERTY="TREESIZE"
          THEN="checkTar"
          TYPE="IF-THEN-ELSE"
          VALUE="1"
          >
          <CONNECTIONS
            ELSE="DIRECT"
            THEN="DIRECT"
            />
        </checkEmpty>
        <checkSize
          COMMENT=""
          ELSE="sendErrorTooBigMail"
          OPERATOR="le"
          POSX="300"
          POSY="1000"
          PROPERTY="TREESIZE"
          THEN="setRootDir"
          TYPE="IF-THEN-ELSE"
          VALUE="%MAXCDSIZE%"
          >
          <CONNECTIONS
            ELSE="DIRECT"
            THEN="DIRECT"
            />
        </checkSize>
        <checkTar
          COMMENT=""
          ELSE="checkSize"
          OPERATOR="is true"
          POSX="200"
          POSY="900"
          PROPERTY="DO_TAR"
          THEN="prepareCdContents"
          TYPE="IF-THEN-ELSE"
          VALUE=""
          >
          <CONNECTIONS
            ELSE="VERTICAL"
            THEN="VERTICAL"
            />
        </checkTar>
        <createIsoFile
          COMMENT=""
          ERROR="END"
          NEXT="END"
          POSX="100"
          POSY="2500"
          TYPE="SWF"
          USE="CdRobot.createIsoFile"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING/>
        </createIsoFile>
        <ftpGetIsoImage
          COMMENT=""
          ERROR="END"
          NAME="CdRobot.ftpGet"
          NEXT="END"
          POSX="300"
          POSY="2100"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS
            FTP_DELETE_SOURCE="Y"
            ISOFILENAME="/home/sepplin6/dpfwork/%JOBID%.iso"
            WU_ENABLE_DEBUG_LOOP="N"
            />
          <MAPPING
            SOURCE="%ISOFILENAME%"
            TARGET="%IMAGEFILE%"
            />
        </ftpGetIsoImage>
        <ftpGetTar
          COMMENT=""
          ERROR="END"
          NAME="FileTransfer.receiveFtp"
          NEXT="setAlso40"
          POSX="100"
          POSY="2100"
          TYPE="WU"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <DEFAULTS
            TARFILENAME="/home/sepplin6/dpfwork/%JOBID%.tar"
            />
          <MAPPING
            FTP_DELETE_SOURCE="Y"
            SOURCE="%TARFILENAME%"
            TARGET="%CURRFILENAME%"
            />
        </ftpGetTar>
        <mapSambaDrive
          COMMENT=""
          ERROR="END"
          NAME="CdRobot.mapSambaDrive"
          NEXT="unixCalculateSize"
          POSX="200"
          POSY="100"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING
            OUTPUTPROPERTY="TARROOTDIR"
            />
        </mapSambaDrive>
        <prepareCdContents
          COMMENT=""
          ERROR="END"
          NEXT="unixTar"
          POSX="100"
          POSY="1300"
          TYPE="SWF"
          USE="CdRobot.prepareCdContents"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING/>
        </prepareCdContents>
        <sendErrorEmptyMail
          COMMENT=""
          ERROR="END"
          NAME="Mail.sendMail"
          NEXT="END"
          POSX="600"
          POSY="700"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS
            EMAIL="%MAIL_DPFADMIN%"
            JOBLOGFILE="%JOBDIR%/job.log"
            MAIL_ATTACH_PROPERTIES="JOBLOGFILE"
            MAIL_EXPAND_TEXT="Y"
            MAIL_SUBJECT="Fehler beim CD Brennauftrag &apos;%MKISO_VOLUME_ID%&apos; mit %TARROOTDIR%: Verzeichnis leer"
            MAIL_TEXT="Hallo %JOBUSERNAME%,\n\nbei Deinem CD Brennauftrag mit dem Verzeichnis %TARROOTDIR%\ntrat ein Fehler auf.\n\nFehlergrund: Der Verzeichnisbaum ist leer!\n\nFür weitere Details siehe die Job Protokolldatei im Anhang dieser Mail,\noder unter %DPFTRACKERURL%?job=%JOBID% ."
            MAIL_TO="%EMAIL%"
            MKISO_VOLUME_ID=""
            />
          <MAPPING/>
        </sendErrorEmptyMail>
        <sendErrorTooBigMail
          COMMENT=""
          ERROR="END"
          NAME="Mail.sendMail"
          NEXT="END"
          POSX="500"
          POSY="1000"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS
            EMAIL="%MAIL_DPFADMIN%"
            JOBLOGFILE="%JOBDIR%/job.log"
            MAIL_ATTACH_PROPERTIES="JOBLOGFILE"
            MAIL_EXPAND_TEXT="Y"
            MAIL_SUBJECT="Fehler beim CD Brennauftrag &apos;%MKISO_VOLUME_ID%&apos; mit %TARROOTDIR%"
            MAIL_TEXT="Hallo %JOBUSERNAME%,\n\nbei Deinem CD Brennauftrag mit dem Verzeichnis %TARROOTDIR%\ntrat ein Fehler auf.\n\nFehlergrund: Der Verzeichnisbaum ist zu groß!\nDer Verzeichnisbaum ist %TREESIZE% KByte groß, erlaubt sind maximal %MAXCDSIZE% KByte.\n\nFür weitere Details siehe die Job Protokolldatei im Anhang dieser Mail,\noder unter %DPFTRACKERURL%?job=%JOBID% ."
            MAIL_TO="%EMAIL%"
            MKISO_VOLUME_ID=""
            />
          <MAPPING/>
        </sendErrorTooBigMail>
        <set20
          COMMENT=""
          NEXT="checkEmpty"
          POSX="200"
          POSY="500"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="20"
            />
        </set20>
        <set25
          COMMENT=""
          NEXT="setTar"
          POSX="100"
          POSY="1700"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="25"
            />
        </set25>
        <set40
          COMMENT=""
          NEXT="setImageFile"
          POSX="300"
          POSY="1600"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="40"
            />
        </set40>
        <setAlso40
          COMMENT=""
          NEXT="createIsoFile"
          POSX="100"
          POSY="2300"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="40"
            />
        </setAlso40>
        <setImageFile
          COMMENT=""
          NEXT="ftpGetIsoImage"
          POSX="300"
          POSY="1800"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            IMAGEFILE="%JOBDIR%/isofile.iso"
            />
        </setImageFile>
        <setRootDir
          COMMENT=""
          NEXT="unixCreateCdImage"
          POSX="300"
          POSY="1200"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            ROOTDIR="%DRIVE_UNIX_PATH%"
            />
        </setRootDir>
        <setTar
          COMMENT=""
          NEXT="ftpGetTar"
          POSX="100"
          POSY="1900"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            CURRFILENAME="%ROOTDIR%/contents.tar"
            />
        </setTar>
        <unixCalculateSize
          COMMENT=""
          ERROR="END"
          NAME="CdRobot.unixCalculateSize"
          NEXT="set20"
          POSX="200"
          POSY="300"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING
            ROOTDIR="%DRIVE_UNIX_PATH%"
            />
        </unixCalculateSize>
        <unixCreateCdImage
          COMMENT=""
          ERROR="END"
          NAME="CdRobot.unixCreateCdImage"
          NEXT="set40"
          POSX="300"
          POSY="1400"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS
            IMAGEFILE="/home/sepplin6/dpfwork/%JOBID%.iso"
            WU_ENABLE_DEBUG_LOOP="N"
            />
          <MAPPING
            ROOTDIR="%DRIVE_UNIX_PATH%"
            WU_ENABLE_DEBUG_LOOP="N"
            />
        </unixCreateCdImage>
        <unixTar
          COMMENT=""
          ERROR="END"
          NAME="FileCompress.unixCreateTar"
          NEXT="set25"
          POSX="100"
          POSY="1500"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS
            TARDIR="%DRIVE_UNIX_PATH%"
            TARFILENAME="/home/sepplin6/dpfwork/%JOBID%.tar"
            WU_ENABLE_DEBUG_LOOP="N"
            />
          <MAPPING/>
        </unixTar>
      </CdRobot.unixBuild>
    </workflows>
  </config>
</DPF>
