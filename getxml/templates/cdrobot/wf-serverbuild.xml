<?xml version="1.0" encoding="ISO-8859-1"?>
<DPF>
  <config>
    <workflows>
      <CdRobot.serverBuild
        COMMENT="build CD data on DPF server side
progress 15...60"
        DPFINT-Icon="doc://:/wf.gif"
        DPFINT-Interactive="0"
        DPFINT-Type="WorkflowDescription"
        INTERNALNAME="serverBuild"
        NAME="Build CD at server side"
        PROJECT="CdRobot"
        VERSION="$Id: wf-serverbuild.xml,v 1.12 2006/12/18 08:43:35 stefan Exp $"
        >
        <DEFAULTS
          DPFINT-Icon="doc://:/defaults.gif"
          />
        <END
          COMMENT=""
          NAME="END"
          POSX="800"
          POSY="1700"
          TYPE="STOP"
          />
        <MAIN
          BEGIN="mapSambaDrive"
          />
        <buildTar
          COMMENT=""
          ERROR="END"
          NAME="FileCompress.createTar"
          NEXT="setAlso40"
          POSX="100"
          POSY="1900"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="HORIZONTAL"
            />
          <DEFAULTS
            TARDIR="%TARROOTDIR%"
            TARFILENAME="%CURRFILENAME%"
            WU_ENABLE_DEBUG_LOOP="N"
            />
          <MAPPING/>
        </buildTar>
        <calculateSize
          COMMENT=""
          ERROR="END"
          NAME="FileSystem.getTreeSize"
          NEXT="set20"
          POSX="200"
          POSY="300"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING
            ROOTDIR="%TARROOTDIR%"
            />
        </calculateSize>
        <checkEmpty
          COMMENT=""
          ELSE="sendErrorEmptyMail"
          OPERATOR="ge"
          POSX="200"
          POSY="700"
          PROPERTY="TREESIZE"
          THEN="checkTar"
          TYPE="IF-THEN-ELSE"
          VALUE="1"
          >
          <CONNECTIONS
            ELSE="DIRECT"
            THEN="DIRECT"
            />
        </checkEmpty>
        <checkSize
          COMMENT=""
          ELSE="sendErrorTooBigMail"
          OPERATOR="le"
          POSX="300"
          POSY="1000"
          PROPERTY="TREESIZE"
          THEN="setRootDir"
          TYPE="IF-THEN-ELSE"
          VALUE="%MAXCDSIZE%"
          >
          <CONNECTIONS
            ELSE="DIRECT"
            THEN="DIRECT"
            />
        </checkSize>
        <checkTar
          COMMENT=""
          ELSE="checkSize"
          OPERATOR="is true"
          POSX="200"
          POSY="900"
          PROPERTY="DO_TAR"
          THEN="prepareCdContents"
          TYPE="IF-THEN-ELSE"
          VALUE=""
          >
          <CONNECTIONS
            ELSE="VERTICAL"
            THEN="VERTICAL"
            />
        </checkTar>
        <createCdImage
          COMMENT=""
          ERROR="END"
          NAME="CdRobot.createCdImage"
          NEXT="END"
          POSX="300"
          POSY="1900"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS
            MKISO_JOLIET="Y"
            />
          <MAPPING/>
        </createCdImage>
        <createIsoFile
          COMMENT=""
          ERROR="END"
          NEXT="END"
          POSX="100"
          POSY="2300"
          TYPE="SWF"
          USE="CdRobot.createIsoFile"
          >
          <DEFAULTS/>
          <MAPPING/>
        </createIsoFile>
        <mapSambaDrive
          COMMENT=""
          ERROR="END"
          NAME="CdRobot.mapSambaDrive"
          NEXT="calculateSize"
          POSX="200"
          POSY="100"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS/>
          <MAPPING
            OUTPUTPROPERTY="TARROOTDIR"
            />
        </mapSambaDrive>
        <prepareCdContents
          COMMENT=""
          ERROR="END"
          NEXT="set25"
          POSX="100"
          POSY="1300"
          TYPE="SWF"
          USE="CdRobot.prepareCdContents"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="VERTICAL"
            />
          <DEFAULTS/>
          <MAPPING/>
        </prepareCdContents>
        <sendErrorEmptyMail
          COMMENT=""
          ERROR="END"
          NAME="Mail.sendMail"
          NEXT="END"
          POSX="500"
          POSY="700"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS
            EMAIL="%MAIL_DPFADMIN%"
            JOBLOGFILE="%JOBDIR%/job.log"
            MAIL_ATTACH_PROPERTIES="JOBLOGFILE"
            MAIL_EXPAND_TEXT="Y"
            MAIL_SUBJECT="Fehler beim CD Brennauftrag &apos;%MKISO_VOLUME_ID%&apos; mit %TARROOTDIR%: Verzeichnis leer"
            MAIL_TEXT="Hallo %JOBUSERNAME%,\n\nbei Deinem CD Brennauftrag mit dem Verzeichnis %TARROOTDIR%\ntrat ein Fehler auf.\n\nFehlergrund: Der Verzeichnisbaum ist leer!\n\nDer Fehler trat an der Stelle\n\nFür weitere Details siehe die Job Protokolldatei im Anhang dieser Mail,\noder unter %DPFTRACKERURL%?job=%JOBID% ."
            MAIL_TO="%EMAIL%"
            MKISO_VOLUME_ID=""
            />
          <MAPPING/>
        </sendErrorEmptyMail>
        <sendErrorTooBigMail
          COMMENT=""
          ERROR="END"
          NAME="Mail.sendMail"
          NEXT="END"
          POSX="600"
          POSY="1000"
          TYPE="WU"
          >
          <CONNECTIONS
            ERROR="DIRECT"
            NEXT="DIRECT"
            />
          <DEFAULTS
            EMAIL="%MAIL_DPFADMIN%"
            JOBLOGFILE="%JOBDIR%/job.log"
            MAIL_ATTACH_PROPERTIES="JOBLOGFILE"
            MAIL_EXPAND_TEXT="Y"
            MAIL_SUBJECT="Fehler beim CD Brennauftrag &apos;%MKISO_VOLUME_ID%&apos; mit %TARROOTDIR%"
            MAIL_TEXT="Hallo %JOBUSERNAME%,\n\nbei Deinem CD Brennauftrag mit dem Verzeichnis %TARROOTDIR%\ntrat ein Fehler auf.\n\nFehlergrund: Der Verzeichnisbaum ist zu groß!\nDer Verzeichnisbaum ist %TREESIZE% KByte groß, erlaubt sind maximal %MAXCDSIZE% KByte.\n\nFür weitere Details siehe die Job Protokolldatei im Anhang dieser Mail,\noder unter %DPFTRACKERURL%?job=%JOBID% ."
            MAIL_TO="%EMAIL%"
            MKISO_VOLUME_ID=""
            />
          <MAPPING/>
        </sendErrorTooBigMail>
        <set20
          COMMENT=""
          NEXT="checkEmpty"
          POSX="200"
          POSY="500"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="20"
            />
        </set20>
        <set25
          COMMENT=""
          NEXT="setTar"
          POSX="100"
          POSY="1500"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="25"
            />
        </set25>
        <setAlso40
          COMMENT=""
          NEXT="createIsoFile"
          POSX="100"
          POSY="2100"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            DPF_JOB_PROGRESS="40"
            />
        </setAlso40>
        <setRootDir
          COMMENT=""
          NEXT="createCdImage"
          POSX="300"
          POSY="1200"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            ROOTDIR="%TARROOTDIR%"
            />
        </setRootDir>
        <setTar
          COMMENT=""
          NEXT="buildTar"
          POSX="100"
          POSY="1700"
          TYPE="MODIFY"
          >
          <CONNECTIONS
            NEXT="DIRECT"
            />
          <SET
            CURRFILENAME="%ROOTDIR%/contents.tar"
            />
        </setTar>
      </CdRobot.serverBuild>
    </workflows>
  </config>
</DPF>
